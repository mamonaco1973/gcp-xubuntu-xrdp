#!/bin/bash

echo "NOTE: Validating that required commands are found in the PATH."

# List of required commands
commands=("gcloud" "terraform")

# Flag to track if all commands are found
all_found=true

# Iterate through each command and check if it's available
for cmd in "${commands[@]}"; do
  if ! command -v "$cmd" &> /dev/null; then
    echo "ERROR: $cmd is not foundin the current PATH."
    all_found=false
  else
    echo "NOTE: $cmd is found in the current PATH."
  fi
done

# Final status
if [ "$all_found" = true ]; then
  echo "NOTE: All required commands are available."
else
  echo "ERROR: One or more commands are missing."
  exit 1
fi

echo "NOTE: Validating credentials.json and test the gcloud command"

# Check if the file "./credentials.json" exists
if [[ ! -f "./credentials.json" ]]; then
  echo "ERROR: The file './credentials.json' does not exist." >&2
  exit 1
fi

gcloud auth activate-service-account --key-file="./credentials.json"

export GOOGLE_APPLICATION_CREDENTIALS=$(pwd)/credentials.json


